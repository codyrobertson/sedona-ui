{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "price-chart",
  "type": "registry:ui",
  "title": "Price Chart",
  "description": "Lightweight trading chart supporting candlestick, line, and area modes",
  "dependencies": [
    "lightweight-charts"
  ],
  "devDependencies": [],
  "registryDependencies": [
    "trading-utils"
  ],
  "files": [
    {
      "path": "components/ui/price-chart.tsx",
      "type": "registry:ui",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport {\n  createChart,\n  ColorType,\n  CandlestickSeries,\n  LineSeries,\n  AreaSeries,\n  type IChartApi,\n  type ISeriesApi,\n  type CandlestickData,\n  type LineData,\n  type Time,\n} from \"lightweight-charts\"\nimport { CHART_COLORS, type ChartTimeframe } from \"@/lib/trading-utils\"\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\nexport type ChartType = \"candlestick\" | \"line\" | \"area\"\n\nexport interface PriceChartProps extends React.HTMLAttributes<HTMLDivElement> {\n  /** Candlestick OHLC data */\n  data?: CandlestickData<Time>[]\n  /** Line/Area data (alternative to candlestick) */\n  lineData?: LineData<Time>[]\n  /** Chart display type */\n  chartType?: ChartType\n  /** Available timeframes */\n  timeframes?: ChartTimeframe[]\n  /** Currently active timeframe */\n  activeTimeframe?: ChartTimeframe\n  /** Callback when timeframe changes */\n  onTimeframeChange?: (timeframe: ChartTimeframe) => void\n  /** Chart height */\n  height?: number\n  /** Show timeframe selector */\n  showTimeframes?: boolean\n  /** Show price scale */\n  showPriceScale?: boolean\n  /** Show time scale */\n  showTimeScale?: boolean\n  /** Custom colors (overrides CHART_COLORS) */\n  colors?: Partial<typeof CHART_COLORS>\n  /** Loading state */\n  loading?: boolean\n}\n\n// =============================================================================\n// COMPONENT\n// =============================================================================\n\nconst PriceChart = React.forwardRef<HTMLDivElement, PriceChartProps>(\n  (\n    {\n      className,\n      data = [],\n      lineData,\n      chartType = \"candlestick\",\n      timeframes = [\"1h\", \"4h\", \"1d\", \"1w\"],\n      activeTimeframe: controlledTimeframe,\n      onTimeframeChange,\n      height = 300,\n      showTimeframes = true,\n      showPriceScale = true,\n      showTimeScale = true,\n      colors: customColors,\n      loading = false,\n      ...props\n    },\n    ref\n  ) => {\n    const chartContainerRef = React.useRef<HTMLDivElement>(null)\n    const chartRef = React.useRef<IChartApi | null>(null)\n    const seriesRef = React.useRef<ISeriesApi<\"Candlestick\" | \"Line\" | \"Area\"> | null>(null)\n    const [mounted, setMounted] = React.useState(false)\n    const [internalTimeframe, setInternalTimeframe] = React.useState<ChartTimeframe>(\n      controlledTimeframe || timeframes[0] || \"1d\"\n    )\n\n    const colors = React.useMemo(\n      () => ({ ...CHART_COLORS, ...customColors }),\n      [customColors]\n    )\n    const currentTimeframe = controlledTimeframe ?? internalTimeframe\n\n    const handleTimeframeChange = (tf: ChartTimeframe) => {\n      if (onTimeframeChange) {\n        onTimeframeChange(tf)\n      } else {\n        setInternalTimeframe(tf)\n      }\n    }\n\n    // Mount tracking\n    React.useEffect(() => {\n      setMounted(true)\n    }, [])\n\n    // Initialize chart\n    React.useEffect(() => {\n      if (!mounted || !chartContainerRef.current) return\n\n      const chart = createChart(chartContainerRef.current, {\n        layout: {\n          background: { type: ColorType.Solid, color: \"transparent\" },\n          textColor: colors.text,\n        },\n        grid: {\n          vertLines: { color: colors.grid },\n          horzLines: { color: colors.grid },\n        },\n        crosshair: {\n          vertLine: { color: colors.crosshair, width: 1, style: 2 },\n          horzLine: { color: colors.crosshair, width: 1, style: 2 },\n        },\n        rightPriceScale: {\n          borderColor: colors.border,\n          visible: showPriceScale,\n          scaleMargins: { top: 0.1, bottom: 0.1 },\n        },\n        timeScale: {\n          borderColor: colors.border,\n          visible: showTimeScale,\n          timeVisible: true,\n        },\n        handleScroll: { mouseWheel: true, pressedMouseMove: true },\n        handleScale: { mouseWheel: true, pinch: true },\n        width: chartContainerRef.current.clientWidth,\n        height,\n      })\n\n      chartRef.current = chart\n\n      // Add series based on chart type\n      if (chartType === \"candlestick\") {\n        const series = chart.addSeries(CandlestickSeries, {\n          upColor: colors.up,\n          downColor: colors.down,\n          borderUpColor: colors.up,\n          borderDownColor: colors.down,\n          wickUpColor: colors.up,\n          wickDownColor: colors.down,\n        })\n        seriesRef.current = series\n        if (data.length > 0) {\n          series.setData(data)\n        }\n      } else if (chartType === \"line\") {\n        const series = chart.addSeries(LineSeries, {\n          color: colors.up,\n          lineWidth: 2,\n        })\n        seriesRef.current = series\n        if (lineData && lineData.length > 0) {\n          series.setData(lineData)\n        }\n      } else if (chartType === \"area\") {\n        const series = chart.addSeries(AreaSeries, {\n          topColor: `${colors.up}40`,\n          bottomColor: `${colors.up}00`,\n          lineColor: colors.up,\n          lineWidth: 2,\n        })\n        seriesRef.current = series\n        if (lineData && lineData.length > 0) {\n          series.setData(lineData)\n        }\n      }\n\n      chart.timeScale().fitContent()\n\n      // Resize handler\n      const handleResize = () => {\n        if (chartContainerRef.current && chartRef.current) {\n          chartRef.current.applyOptions({\n            width: chartContainerRef.current.clientWidth,\n          })\n        }\n      }\n\n      window.addEventListener(\"resize\", handleResize)\n\n      return () => {\n        window.removeEventListener(\"resize\", handleResize)\n        if (chartRef.current) {\n          chartRef.current.remove()\n          chartRef.current = null\n          seriesRef.current = null\n        }\n      }\n    }, [mounted, chartType, height, showPriceScale, showTimeScale, colors])\n\n    // Update data when it changes\n    React.useEffect(() => {\n      if (!seriesRef.current) return\n\n      if (chartType === \"candlestick\" && data.length > 0) {\n        seriesRef.current.setData(data as CandlestickData<Time>[])\n      } else if (lineData && lineData.length > 0) {\n        seriesRef.current.setData(lineData as LineData<Time>[])\n      }\n\n      chartRef.current?.timeScale().fitContent()\n    }, [data, lineData, chartType])\n\n    return (\n      <div ref={ref} className={cn(\"w-full\", className)} {...props}>\n        <div className=\"rounded-lg border border-border bg-card overflow-hidden\">\n          {/* Timeframe selector */}\n          {showTimeframes && (\n            <div className=\"flex items-center gap-1 px-3 py-2 border-b border-border\">\n              {timeframes.map((tf) => (\n                <button\n                  key={tf}\n                  onClick={() => handleTimeframeChange(tf)}\n                  className={cn(\n                    \"px-2.5 py-1 rounded text-xs font-medium transition-colors\",\n                    currentTimeframe === tf\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"text-muted-foreground hover:text-foreground hover:bg-muted\"\n                  )}\n                >\n                  {tf.toUpperCase()}\n                </button>\n              ))}\n            </div>\n          )}\n\n          {/* Chart area */}\n          <div className=\"relative\" style={{ height }}>\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-background/50 z-10\">\n                <div className=\"animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            )}\n            {!mounted ? (\n              <div className=\"flex items-center justify-center h-full\">\n                <span className=\"text-muted-foreground text-sm\">Loading chart...</span>\n              </div>\n            ) : (\n              <div ref={chartContainerRef} className=\"w-full h-full\" />\n            )}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\n\nPriceChart.displayName = \"PriceChart\"\n\nexport { PriceChart, CHART_COLORS }\n"
    }
  ]
}