{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "swap-widget",
  "type": "registry:ui",
  "title": "Swap Widget",
  "description": "Complete token swap interface with slippage controls and quote management",
  "dependencies": [],
  "devDependencies": [],
  "registryDependencies": [
    "swap-utils",
    "button",
    "popover",
    "token-avatar",
    "icon"
  ],
  "files": [
    {
      "path": "components/ui/swap-widget.tsx",
      "type": "registry:ui",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport {\n  formatNumber,\n  formatUSD,\n  sanitizeNumericInput,\n  parseBalance,\n  getSlippageMultiplier,\n} from \"@/lib/swap-utils\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { Icon } from \"@/components/ui/icon\"\nimport { TokenAvatar } from \"@/components/ui/token-avatar\"\n\n// ============================================================================\n// Types - Designed for API flexibility\n// ============================================================================\n\nexport interface Token {\n  /** Token ticker symbol (e.g., \"SOL\", \"USDC\") */\n  symbol: string\n  /** Full token name */\n  name: string\n  /** Optional image URL for token avatar */\n  imageUrl?: string\n  /** Token decimals for input precision (default: 9) */\n  decimals?: number\n  /** User's balance of this token (as string to preserve precision) */\n  balance: string\n  /** Current price in USD */\n  price: number\n  /** Whether this is a native token (for gas reservation) */\n  isNative?: boolean\n  /** Minimum trade amount (optional, for validation) */\n  minAmount?: string\n  /** Maximum trade amount (optional, for validation) */\n  maxAmount?: string\n}\n\nexport interface SwapQuote {\n  /** Amount user will receive */\n  receiveAmount: string\n  /** Exchange rate (1 pay token = X receive tokens) */\n  exchangeRate: number\n  /** Price impact percentage */\n  priceImpact: number\n  /** Minimum received after slippage */\n  minReceived: string\n  /** Network/gas fee estimate (optional) */\n  networkFee?: string\n  /** Quote expiry timestamp in ms (optional) */\n  expiresAt?: number\n  /** Any additional data from your API */\n  metadata?: Record<string, unknown>\n}\n\nexport interface SwapError {\n  /** Error code for programmatic handling */\n  code: \"QUOTE_FAILED\" | \"INSUFFICIENT_LIQUIDITY\" | \"NETWORK_ERROR\" | \"QUOTE_EXPIRED\" | \"AMOUNT_TOO_SMALL\" | \"AMOUNT_TOO_LARGE\" | \"UNKNOWN\"\n  /** Human-readable message */\n  message: string\n}\n\nexport type SwapStatus =\n  | \"idle\"           // Ready to swap\n  | \"quoting\"        // Fetching quote\n  | \"ready\"          // Quote received, ready to execute\n  | \"swapping\"       // Swap in progress\n  | \"success\"        // Swap completed\n  | \"error\"          // Error occurred\n\nexport type TradingStatus =\n  | \"active\"         // Trading enabled\n  | \"inactive\"       // Game/trading not active\n  | \"maintenance\"    // System maintenance\n  | \"restricted\"     // User restricted from trading\n\nexport interface SwapWidgetProps {\n  /** Pay token configuration */\n  payToken: Token\n  /** Receive token configuration */\n  receiveToken: Token\n\n  // === Status & State ===\n  /** Overall trading status - controls if swaps are allowed */\n  tradingStatus?: TradingStatus\n  /** Custom message when trading is not active */\n  tradingStatusMessage?: string\n  /** Initial slippage setting */\n  slippage?: string\n  /** Available slippage presets */\n  slippagePresets?: string[]\n  /** Gas reserve for native token (default: 0.01) */\n  nativeGasReserve?: string\n\n  // === Quote Settings ===\n  /** Quote refresh interval in ms (0 = no auto refresh) */\n  quoteRefreshInterval?: number\n  /** Debounce delay for quote requests in ms */\n  quoteDebounceMs?: number\n\n  // === Callbacks - Design for your API ===\n  /**\n   * Fetch a swap quote from your API\n   * Return null to indicate no quote available\n   * Throw SwapError for error handling\n   */\n  onQuoteRequest?: (params: {\n    payToken: Token\n    receiveToken: Token\n    payAmount: string\n    slippage: string\n  }) => Promise<SwapQuote | null>\n\n  /**\n   * Execute the swap\n   * Called with all relevant data for your API\n   */\n  onSwap?: (params: {\n    payToken: Token\n    receiveToken: Token\n    payAmount: string\n    receiveAmount: string\n    minReceived: string\n    slippage: string\n    quote: SwapQuote\n  }) => Promise<void>\n\n  /** Called when user flips pay/receive tokens */\n  onFlip?: () => void\n  /** Called when user clicks pay token selector */\n  onPayTokenSelect?: () => void\n  /** Called when user clicks receive token selector */\n  onReceiveTokenSelect?: () => void\n  /** Called on any error */\n  onError?: (error: SwapError) => void\n\n  className?: string\n}\n\n// ============================================================================\n// Sub-components\n// ============================================================================\n\ninterface SwapCardProps {\n  value: string\n  onChange: (value: string) => void\n  token: Token\n  usdValue: number\n  onTokenSelect?: () => void\n  disabled?: boolean\n  isCalculating?: boolean\n  hasError?: boolean\n  errorMessage?: string\n}\n\nconst SwapCard = ({\n  value,\n  onChange,\n  token,\n  usdValue,\n  onTokenSelect,\n  disabled = false,\n  isCalculating = false,\n  hasError = false,\n  errorMessage,\n}: SwapCardProps) => {\n  const inputRef = React.useRef<HTMLInputElement>(null)\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const sanitized = sanitizeNumericInput(e.target.value, token.decimals || 9)\n    onChange(sanitized)\n  }\n\n  // Click anywhere on card to focus input\n  const handleCardClick = (e: React.MouseEvent) => {\n    // Don't focus if clicking on token selector button\n    if ((e.target as HTMLElement).closest('button')) return\n    inputRef.current?.focus()\n  }\n\n  return (\n    <div\n      onClick={handleCardClick}\n      className={cn(\n        \"rounded-xl border p-3 transition-all cursor-text\",\n        \"focus-within:ring-2 focus-within:ring-sedona-500/50 focus-within:border-sedona-500\",\n        hasError\n          ? \"border-zeus-status-destructive bg-zeus-status-destructive/5 focus-within:ring-zeus-status-destructive/50 focus-within:border-zeus-status-destructive\"\n          : \"border-zeus-border-alpha bg-zeus-surface-default\"\n      )}\n      role=\"group\"\n      aria-label={`${token.symbol} amount input`}\n    >\n      {/* Input Row */}\n      <div className=\"flex items-center gap-3\">\n        <TokenAvatar ticker={token.symbol} size=\"md\" imageUrl={token.imageUrl} />\n\n        {isCalculating ? (\n          <div className=\"flex-1 flex items-center\" aria-live=\"polite\" aria-busy=\"true\">\n            <Icon icon=\"spinner\" className=\"w-5 h-5 text-zeus-text-tertiary animate-spin\" />\n            <span className=\"sr-only\">Calculating...</span>\n          </div>\n        ) : (\n          <input\n            ref={inputRef}\n            type=\"text\"\n            inputMode=\"decimal\"\n            placeholder=\"0\"\n            value={value}\n            onChange={handleChange}\n            disabled={disabled}\n            aria-label={`Enter ${token.symbol} amount`}\n            aria-invalid={hasError}\n            aria-describedby={hasError ? \"swap-error\" : undefined}\n            className={cn(\n              \"flex-1 min-w-0 bg-transparent text-2xl font-semibold text-zeus-text-primary\",\n              \"placeholder:text-zeus-text-quaternary\",\n              \"focus:outline-none focus:ring-0\",\n              \"disabled:opacity-60 disabled:cursor-not-allowed\"\n            )}\n          />\n        )}\n\n        <button\n          type=\"button\"\n          onClick={onTokenSelect}\n          disabled={disabled}\n          aria-label={`Select ${token.symbol} token`}\n          className=\"flex items-center gap-1 px-3 py-2 rounded-full bg-zeus-surface-elevated hover:bg-zeus-surface-neutral-subtle transition-colors disabled:opacity-50 flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-sedona-500/50\"\n        >\n          <span className=\"text-zeus-text-primary text-sm font-semibold\">\n            {token.symbol}\n          </span>\n          <Icon icon=\"arrows-up-down\" className=\"w-4 h-4 text-zeus-text-tertiary\" />\n        </button>\n      </div>\n\n      {/* Info Row */}\n      <div className=\"flex items-center justify-between mt-2 text-[11px]\">\n        <span\n          className={cn(\n            hasError ? \"text-zeus-status-destructive\" : \"text-zeus-text-tertiary\"\n          )}\n          id={hasError ? \"swap-error\" : undefined}\n        >\n          {errorMessage || formatUSD(usdValue)}\n        </span>\n        <span className=\"text-zeus-text-tertiary\">\n          {formatNumber(token.balance)} {token.symbol}\n        </span>\n      </div>\n    </div>\n  )\n}\n\ninterface SlippagePopoverProps {\n  value: string\n  onChange: (value: string) => void\n  presets?: string[]\n}\n\nconst SlippagePopover = ({\n  value,\n  onChange,\n  presets = [\"0.5\", \"1.0\", \"2.0\"]\n}: SlippagePopoverProps) => {\n  return (\n    <Popover>\n      <PopoverTrigger asChild>\n        <button\n          aria-label={`Slippage tolerance: ${value === \"Auto\" ? \"Auto\" : `${value}%`}`}\n          className=\"flex items-center gap-1 px-2.5 py-1 rounded-full bg-zeus-surface-elevated hover:bg-zeus-surface-neutral-subtle transition-colors text-[11px] focus:outline-none focus:ring-2 focus:ring-sedona-500/50\"\n        >\n          <span className=\"text-zeus-text-tertiary\">Slip:</span>\n          <span className=\"text-sedona-500 font-medium\">\n            {value === \"Auto\" ? \"Auto\" : `${value}%`}\n          </span>\n          <Icon icon=\"gear\" className=\"w-3 h-3 text-zeus-text-tertiary\" />\n        </button>\n      </PopoverTrigger>\n      <PopoverContent\n        align=\"end\"\n        className=\"w-48 p-2 bg-zeus-surface-neutral border-zeus-border-alpha\"\n      >\n        <div className=\"space-y-2\" role=\"radiogroup\" aria-label=\"Slippage tolerance\">\n          <div className=\"text-[11px] font-medium text-zeus-text-secondary\">Slippage Tolerance</div>\n          <div className=\"flex gap-1\">\n            <button\n              onClick={() => onChange(\"Auto\")}\n              role=\"radio\"\n              aria-checked={value === \"Auto\"}\n              className={cn(\n                \"flex-1 px-2 py-1.5 rounded text-[11px] font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-sedona-500/50\",\n                value === \"Auto\"\n                  ? \"bg-sedona-500 text-white\"\n                  : \"bg-zeus-surface-elevated text-zeus-text-secondary hover:text-zeus-text-primary\"\n              )}\n            >\n              Auto\n            </button>\n            {presets.map((preset) => (\n              <button\n                key={preset}\n                onClick={() => onChange(preset)}\n                role=\"radio\"\n                aria-checked={value === preset}\n                className={cn(\n                  \"flex-1 px-2 py-1.5 rounded text-[11px] font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-sedona-500/50\",\n                  value === preset\n                    ? \"bg-sedona-500 text-white\"\n                    : \"bg-zeus-surface-elevated text-zeus-text-secondary hover:text-zeus-text-primary\"\n                )}\n              >\n                {preset}%\n              </button>\n            ))}\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nconst SwapWidget = React.forwardRef<HTMLDivElement, SwapWidgetProps>(\n  (\n    {\n      payToken,\n      receiveToken,\n      tradingStatus = \"active\",\n      tradingStatusMessage,\n      slippage: initialSlippage = \"Auto\",\n      slippagePresets,\n      nativeGasReserve = \"0.01\",\n      quoteRefreshInterval = 30000,\n      quoteDebounceMs = 300,\n      onQuoteRequest,\n      onSwap,\n      onFlip,\n      onPayTokenSelect,\n      onReceiveTokenSelect,\n      onError,\n      className,\n    },\n    ref\n  ) => {\n    // === State ===\n    const [payAmount, setPayAmount] = React.useState(\"\")\n    const [receiveAmount, setReceiveAmount] = React.useState(\"\")\n    const [slippage, setSlippage] = React.useState(initialSlippage)\n    const [quote, setQuote] = React.useState<SwapQuote | null>(null)\n    const [status, setStatus] = React.useState<SwapStatus>(\"idle\")\n    const [error, setError] = React.useState<SwapError | null>(null)\n    const [quoteTimestamp, setQuoteTimestamp] = React.useState<number | null>(null)\n\n    // Refs for cleanup\n    const abortControllerRef = React.useRef<AbortController | null>(null)\n    const quoteIntervalRef = React.useRef<NodeJS.Timeout | null>(null)\n\n    // === Derived Values ===\n    const payAmountNum = parseFloat(payAmount) || 0\n    const payBalance = parseBalance(payToken.balance)\n    const payUsdValue = payAmountNum * payToken.price\n    const receiveAmountNum = parseFloat(receiveAmount) || 0\n    const receiveUsdValue = receiveAmountNum * receiveToken.price\n\n    // Calculate max amount (reserve gas for native tokens)\n    const maxPayAmount = payToken.isNative\n      ? Math.max(0, payBalance - parseFloat(nativeGasReserve))\n      : payBalance\n\n    // === Validation ===\n    const isTradingDisabled = tradingStatus !== \"active\"\n    const insufficientBalance = payAmountNum > payBalance\n    const exceedsMax = payAmountNum > maxPayAmount && payToken.isNative\n    const belowMinimum = payToken.minAmount && payAmountNum > 0 && payAmountNum < parseFloat(payToken.minAmount)\n    const aboveMaximum = payToken.maxAmount && payAmountNum > parseFloat(payToken.maxAmount)\n    const hasValidAmount = payAmountNum > 0\n    const isQuoteExpired = quote?.expiresAt ? Date.now() > quote.expiresAt : false\n\n    const hasError = insufficientBalance || exceedsMax || belowMinimum || aboveMaximum\n    const canSwap = hasValidAmount &&\n                    !hasError &&\n                    !isTradingDisabled &&\n                    status !== \"quoting\" &&\n                    status !== \"swapping\" &&\n                    quote !== null &&\n                    !isQuoteExpired\n\n    // === Error Message ===\n    const getErrorMessage = (): string | undefined => {\n      if (insufficientBalance) return `Insufficient ${payToken.symbol}`\n      if (exceedsMax) return `Reserve ${nativeGasReserve} ${payToken.symbol} for gas`\n      if (belowMinimum) return `Min: ${payToken.minAmount} ${payToken.symbol}`\n      if (aboveMaximum) return `Max: ${payToken.maxAmount} ${payToken.symbol}`\n      return undefined\n    }\n\n    // === Button State ===\n    const getButtonConfig = (): { text: string; disabled: boolean; variant: \"light\" | \"destructive\" | \"ghost\" } => {\n      if (isTradingDisabled) {\n        return {\n          text: tradingStatusMessage || getTradingStatusMessage(tradingStatus),\n          disabled: true,\n          variant: \"ghost\"\n        }\n      }\n      if (status === \"swapping\") return { text: \"Swapping...\", disabled: true, variant: \"light\" }\n      if (!hasValidAmount) return { text: \"Enter amount\", disabled: true, variant: \"light\" }\n      if (hasError) return { text: getErrorMessage() || \"Error\", disabled: true, variant: \"destructive\" }\n      if (status === \"quoting\") return { text: \"Getting quote...\", disabled: true, variant: \"light\" }\n      if (isQuoteExpired) return { text: \"Quote expired - refresh\", disabled: true, variant: \"ghost\" }\n      if (error) return { text: \"Retry\", disabled: false, variant: \"light\" }\n      return { text: \"Swap Tokens\", disabled: false, variant: \"light\" }\n    }\n\n    function getTradingStatusMessage(s: TradingStatus): string {\n      switch (s) {\n        case \"inactive\": return \"Trading not active\"\n        case \"maintenance\": return \"Under maintenance\"\n        case \"restricted\": return \"Trading restricted\"\n        default: return \"Trading unavailable\"\n      }\n    }\n\n    // === Quote Fetching ===\n    const fetchQuote = React.useCallback(async (amount: string) => {\n      // Cancel any pending request\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort()\n      }\n\n      const amountNum = parseFloat(amount)\n      if (!amount || amountNum <= 0 || isTradingDisabled) {\n        setReceiveAmount(\"\")\n        setQuote(null)\n        setStatus(\"idle\")\n        setError(null)\n        return\n      }\n\n      // Validate before fetching\n      if (amountNum > payBalance) {\n        setReceiveAmount(\"\")\n        setQuote(null)\n        return\n      }\n\n      abortControllerRef.current = new AbortController()\n      setStatus(\"quoting\")\n      setError(null)\n\n      try {\n        if (onQuoteRequest) {\n          const newQuote = await onQuoteRequest({\n            payToken,\n            receiveToken,\n            payAmount: amount,\n            slippage,\n          })\n\n          // Check if request was aborted\n          if (abortControllerRef.current?.signal.aborted) return\n\n          if (newQuote) {\n            setQuote(newQuote)\n            setReceiveAmount(newQuote.receiveAmount)\n            setQuoteTimestamp(Date.now())\n            setStatus(\"ready\")\n          } else {\n            setReceiveAmount(\"\")\n            setQuote(null)\n            setStatus(\"idle\")\n          }\n        } else {\n          // Mock for development - remove in production\n          const mockRate = receiveToken.price > 0 ? payToken.price / receiveToken.price : 1\n          const receive = (amountNum * mockRate).toFixed(6)\n          const slippageMultiplier = getSlippageMultiplier(slippage)\n\n          setReceiveAmount(receive)\n          setQuote({\n            receiveAmount: receive,\n            exchangeRate: mockRate,\n            priceImpact: amountNum > 10 ? 2.5 : 0.1,\n            minReceived: (parseFloat(receive) * slippageMultiplier).toFixed(6),\n            expiresAt: Date.now() + 30000, // 30s expiry\n          })\n          setQuoteTimestamp(Date.now())\n          setStatus(\"ready\")\n        }\n      } catch (err) {\n        if (abortControllerRef.current?.signal.aborted) return\n\n        const swapError: SwapError = {\n          code: \"QUOTE_FAILED\",\n          message: err instanceof Error ? err.message : \"Failed to get quote\",\n        }\n        setError(swapError)\n        setStatus(\"error\")\n        onError?.(swapError)\n      }\n    }, [payToken, receiveToken, slippage, payBalance, isTradingDisabled, onQuoteRequest, onError])\n\n    // === Effects ===\n\n    // Debounced quote fetch on amount change\n    React.useEffect(() => {\n      const debounce = setTimeout(() => {\n        fetchQuote(payAmount)\n      }, quoteDebounceMs)\n\n      return () => clearTimeout(debounce)\n    }, [payAmount, fetchQuote, quoteDebounceMs])\n\n    // Reset state when tokens change\n    React.useEffect(() => {\n      setPayAmount(\"\")\n      setReceiveAmount(\"\")\n      setQuote(null)\n      setError(null)\n      setStatus(\"idle\")\n    }, [payToken.symbol, receiveToken.symbol])\n\n    // Auto-refresh quote\n    React.useEffect(() => {\n      if (quoteRefreshInterval <= 0 || !hasValidAmount || isTradingDisabled) {\n        if (quoteIntervalRef.current) {\n          clearInterval(quoteIntervalRef.current)\n          quoteIntervalRef.current = null\n        }\n        return\n      }\n\n      quoteIntervalRef.current = setInterval(() => {\n        if (payAmount && status === \"ready\") {\n          fetchQuote(payAmount)\n        }\n      }, quoteRefreshInterval)\n\n      return () => {\n        if (quoteIntervalRef.current) {\n          clearInterval(quoteIntervalRef.current)\n        }\n      }\n    }, [quoteRefreshInterval, hasValidAmount, isTradingDisabled, payAmount, status, fetchQuote])\n\n    // Cleanup on unmount\n    React.useEffect(() => {\n      return () => {\n        if (abortControllerRef.current) {\n          abortControllerRef.current.abort()\n        }\n        if (quoteIntervalRef.current) {\n          clearInterval(quoteIntervalRef.current)\n        }\n      }\n    }, [])\n\n    // === Handlers ===\n    const handleQuickAmount = (percent: number) => {\n      if (isTradingDisabled) return\n      const baseAmount = percent === 100 ? maxPayAmount : payBalance\n      const amount = (baseAmount * percent / 100)\n      // Use token decimals for precision\n      const decimals = payToken.decimals || 9\n      setPayAmount(amount.toFixed(Math.min(decimals, 6)))\n    }\n\n    const handleFlip = () => {\n      if (isTradingDisabled) return\n\n      // Swap the amounts\n      const tempPay = payAmount\n      const tempReceive = receiveAmount\n\n      setPayAmount(tempReceive)\n      setReceiveAmount(tempPay)\n      setQuote(null)\n      setError(null)\n\n      // Notify parent to swap tokens\n      // Parent should swap payToken <-> receiveToken props\n      onFlip?.()\n    }\n\n    const handleRefresh = () => {\n      if (payAmount) {\n        fetchQuote(payAmount)\n      }\n    }\n\n    const handleSwap = async () => {\n      if (!canSwap || !quote) return\n\n      setStatus(\"swapping\")\n      setError(null)\n\n      try {\n        await onSwap?.({\n          payToken,\n          receiveToken,\n          payAmount,\n          receiveAmount,\n          minReceived: quote.minReceived,\n          slippage,\n          quote,\n        })\n        setStatus(\"success\")\n        // Reset after successful swap\n        setPayAmount(\"\")\n        setReceiveAmount(\"\")\n        setQuote(null)\n        setTimeout(() => setStatus(\"idle\"), 2000)\n      } catch (err) {\n        const swapError: SwapError = {\n          code: \"UNKNOWN\",\n          message: err instanceof Error ? err.message : \"Swap failed\",\n        }\n        setError(swapError)\n        setStatus(\"error\")\n        onError?.(swapError)\n      }\n    }\n\n    const buttonConfig = getButtonConfig()\n\n    return (\n      <div ref={ref} className={cn(\"space-y-2\", className)}>\n        {/* Trading Status Banner */}\n        {isTradingDisabled && (\n          <div className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-zeus-status-warning/10 border border-zeus-status-warning/20\">\n            <Icon icon=\"triangle-exclamation\" className=\"w-4 h-4 text-zeus-status-warning flex-shrink-0\" />\n            <span className=\"text-caption-s text-zeus-status-warning\">\n              {tradingStatusMessage || getTradingStatusMessage(tradingStatus)}\n            </span>\n          </div>\n        )}\n\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-1.5\" role=\"group\" aria-label=\"Quick amount selection\">\n            <span className=\"text-zeus-text-primary text-caption-s font-semibold\" id=\"pay-label\">Pay</span>\n            {[25, 50, 100].map((pct) => (\n              <button\n                key={pct}\n                onClick={() => handleQuickAmount(pct)}\n                disabled={isTradingDisabled}\n                aria-label={pct === 100 ? \"Use maximum balance\" : `Use ${pct}% of balance`}\n                className=\"px-2 py-0.5 rounded-full bg-zeus-surface-elevated text-[10px] text-zeus-text-tertiary hover:text-zeus-text-secondary transition-colors disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-sedona-500/50\"\n              >\n                {pct === 100 ? \"Max\" : `${pct}%`}\n              </button>\n            ))}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {quote && hasValidAmount && (\n              <button\n                onClick={handleRefresh}\n                disabled={status === \"quoting\" || isTradingDisabled}\n                aria-label=\"Refresh quote\"\n                className=\"p-1 rounded-full hover:bg-zeus-surface-elevated transition-colors disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-sedona-500/50\"\n              >\n                <Icon\n                  icon=\"arrows-rotate\"\n                  className={cn(\n                    \"w-3 h-3 text-zeus-text-tertiary\",\n                    status === \"quoting\" && \"animate-spin\"\n                  )}\n                />\n              </button>\n            )}\n            <SlippagePopover\n              value={slippage}\n              onChange={setSlippage}\n              presets={slippagePresets}\n            />\n          </div>\n        </div>\n\n        {/* Cards with overlapping toggle */}\n        <div className=\"relative\">\n          <SwapCard\n            value={payAmount}\n            onChange={setPayAmount}\n            token={payToken}\n            usdValue={payUsdValue}\n            onTokenSelect={onPayTokenSelect}\n            disabled={isTradingDisabled}\n            hasError={hasError && hasValidAmount ? true : false}\n            errorMessage={hasValidAmount ? getErrorMessage() : undefined}\n          />\n\n          <div className=\"h-3\" />\n\n          <SwapCard\n            value={receiveAmount}\n            onChange={() => {}} // Read-only\n            token={receiveToken}\n            usdValue={receiveUsdValue}\n            onTokenSelect={onReceiveTokenSelect}\n            disabled={true}\n            isCalculating={status === \"quoting\"}\n          />\n\n          <button\n            onClick={handleFlip}\n            disabled={isTradingDisabled}\n            aria-label=\"Swap pay and receive tokens\"\n            className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 p-2.5 rounded-full bg-zeus-surface-elevated border border-zeus-border-alpha hover:bg-zeus-surface-neutral-subtle transition-colors disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-sedona-500/50\"\n          >\n            <Icon icon=\"arrow-down-arrow-up\" className=\"w-4 h-4 text-zeus-text-secondary\" />\n          </button>\n        </div>\n\n        {/* Swap Button */}\n        <Button\n          variant={buttonConfig.variant}\n          className=\"w-full h-11 mt-2\"\n          onClick={handleSwap}\n          disabled={buttonConfig.disabled}\n        >\n          {status === \"swapping\" && <Icon icon=\"spinner\" className=\"w-4 h-4 mr-2 animate-spin\" />}\n          {buttonConfig.text}\n        </Button>\n\n        {/* Quote Info Footer */}\n        {quote && hasValidAmount && !hasError && (\n          <div className=\"flex items-center justify-center gap-2 text-[10px] text-zeus-text-tertiary pt-1\">\n            <span>Min: {formatNumber(quote.minReceived)} {receiveToken.symbol}</span>\n            <span>·</span>\n            <span className={cn(\n              quote.priceImpact < 1 && \"text-zeus-status-success\",\n              quote.priceImpact >= 1 && quote.priceImpact < 5 && \"text-zeus-status-warning\",\n              quote.priceImpact >= 5 && \"text-zeus-status-destructive\"\n            )}>\n              Impact: {quote.priceImpact < 0.01 ? \"<0.01\" : quote.priceImpact.toFixed(2)}%\n            </span>\n            {quote.expiresAt && (\n              <>\n                <span>·</span>\n                <QuoteCountdown expiresAt={quote.expiresAt} onExpire={() => setStatus(\"idle\")} />\n              </>\n            )}\n          </div>\n        )}\n\n        {/* Error Display */}\n        {error && status === \"error\" && (\n          <div className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-zeus-status-destructive/10 text-caption-s text-zeus-status-destructive\">\n            <Icon icon=\"triangle-exclamation\" className=\"w-3 h-3 flex-shrink-0\" />\n            {error.message}\n          </div>\n        )}\n      </div>\n    )\n  }\n)\n\n// Quote countdown component\nconst QuoteCountdown = ({ expiresAt, onExpire }: { expiresAt: number; onExpire: () => void }) => {\n  const [secondsLeft, setSecondsLeft] = React.useState(Math.max(0, Math.floor((expiresAt - Date.now()) / 1000)))\n\n  React.useEffect(() => {\n    const interval = setInterval(() => {\n      const remaining = Math.max(0, Math.floor((expiresAt - Date.now()) / 1000))\n      setSecondsLeft(remaining)\n      if (remaining === 0) {\n        onExpire()\n        clearInterval(interval)\n      }\n    }, 1000)\n\n    return () => clearInterval(interval)\n  }, [expiresAt, onExpire])\n\n  if (secondsLeft <= 0) return null\n\n  return (\n    <span className={cn(secondsLeft <= 10 && \"text-zeus-status-warning\")}>\n      {secondsLeft}s\n    </span>\n  )\n}\n\nSwapWidget.displayName = \"SwapWidget\"\n\nexport { SwapWidget }\n"
    }
  ]
}